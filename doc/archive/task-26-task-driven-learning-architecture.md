# Implementation Plan (Generated by PLAN mode)

## ✅ Step 1: Database and Interface Schema Updates
- [x] Modified `Card` interface to include `learningStep: number` field
- [x] Updated `UserSettings` interface with `enableTraditionalLearningSteps: boolean`
- [x] Updated `DEFAULT_USER_SETTINGS` with `enableTraditionalLearningSteps: false`
- [x] Updated database version to 3 with migration logic for existing cards
- [x] Updated `createCardsForNote` method to initialize new cards with `learningStep: 0`

## ✅ Step 2: FSRS Service State Machine Implementation
- [x] Refactored `reviewCard` method in `fsrsService.ts` as central dispatcher
- [x] Implemented `handleTaskDrivenLearning` for default mode (task completion → graduation)
- [x] Implemented `handleTraditionalLearningSteps` for advanced mode (time-based steps)
- [x] Added helper methods: `parseTimeInterval`, `graduateCard`, `applyFSRSScheduling`
- [x] Added settings integration with real-time updates

## ✅ Step 3: Settings Page Updates
- [x] Added learning mode selection with radio buttons (Task-Driven vs Traditional)
- [x] Implemented conditional display for learning steps (disabled in task-driven mode)
- [x] Added comprehensive explanations for both learning modes
- [x] Updated info section with detailed mode descriptions and benefits
- [x] Added visual indicators for disabled fields in task-driven mode

## ✅ Step 4: Review UI Transformation
- [x] Added user settings state and loading in Review.tsx
- [x] Implemented `shouldShowTaskInterface()` logic based on card state and settings
- [x] Created task completion interface with textarea input and action buttons
- [x] Added `handleTaskCompletion()` and `handleTaskFailure()` functions
- [x] Maintained traditional rating buttons for Review cards and traditional mode
- [x] Added conditional UI rendering with proper styling and UX

## ✅ Step 5: Comprehensive Testing
- [x] Created comprehensive test suite with 14 test cases
- [x] Tested task-driven mode: new card graduation, relearning, review transitions
- [x] Tested traditional mode: learning steps progression, relearning steps, graduation
- [x] Tested error handling: database errors, missing cards
- [x] Tested settings integration and mode switching
- [x] All tests passing successfully

## ✅ Implementation Complete

### Key Features Implemented:

**Task-Driven Learning (Default Mode):**
- New/Relearning cards show task completion interface
- Users input translation/retelling in textarea
- "Submit Translation" button graduates card to Review phase
- "Cannot Complete" button keeps card in task phase for retry
- Immediate graduation upon successful task completion
- FSRS handles all long-term review scheduling

**Traditional Learning Steps (Advanced Mode):**
- Anki-style time-based learning intervals (e.g., 1min → 10min)
- Cards progress through configured learning steps
- Traditional Again/Hard/Good/Easy rating buttons
- Learning/Relearning steps control short-term repetition
- Full compatibility with existing Anki workflows

**Hybrid Architecture:**
- Central dispatcher in `reviewCard` method
- Settings-driven mode selection
- Seamless switching between modes
- Backward compatibility maintained
- Database migration for existing cards

**User Experience:**
- Clear mode explanations in settings
- Conditional UI based on card state and mode
- Visual indicators for disabled features
- Comprehensive help text and tooltips
- Responsive design for all screen sizes

### Test Coverage:
- 14 comprehensive test cases
- Both learning modes fully tested
- Error handling and edge cases covered
- Settings integration verified
- 100% test pass rate

### Files Modified:
- `src/shared/types/index.ts` - Interface updates
- `src/background/db.ts` - Database schema and migration
- `src/background/fsrsService.ts` - Core state machine logic
- `src/main/pages/SettingsPage.tsx` - UI for mode selection
- `src/main/pages/Review.tsx` - Conditional review interface
- `src/task-driven-learning.test.ts` - Comprehensive test suite

### Database Changes:
- Version upgraded from 2 to 3
- Added `learningStep` field to cards table
- Migration logic for existing cards (defaults to 0)
- Backward compatibility maintained

The Task-Driven Learning Architecture is now fully implemented and ready for production use. 