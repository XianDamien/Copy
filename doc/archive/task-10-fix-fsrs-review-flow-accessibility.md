# Context
Filename: task-10-fix-fsrs-review-flow-accessibility.md
Created On: 2025-01-27 22:30
Created By: Claude 4 Sonnet
Associated Protocol: RIPER-5 + Sequential Thinking + Agent Protocol

# Task Description
**Critical Issue**: There is no accessible way to enter the FSRS card review page where users can click "again, difficult, good, and easy" buttons for spaced repetition learning. The review flow is broken due to navigation bugs and missing UI elements.

**User Requirements**:
- Fix broken navigation from CardBrowser "Start Learning" to Review page
- Add direct "Review" buttons to DeckList with due card counts
- Make review entry points more intuitive and informative
- Ensure deck-specific review sessions work correctly
- Display card statistics (new, learning, due) on deck cards

# Project Overview
AnGear Language Learning Extension - Chrome extension for spaced repetition learning with FSRS algorithm. The Review.tsx component exists and is functional, but users cannot properly access it due to broken navigation flow and missing UI entry points.

---
*The following sections are maintained by the AI during protocol execution*
---

# Analysis (Populated by RESEARCH mode)

## Core Issues Identified
1. **Navigation Bug in MainApp.tsx**: The `handleStartLearning` function sets `selectedDeckId` but never passes it to the Review component, causing deck-specific reviews to default to deck selection screen.

2. **Missing UI Elements in DeckList.tsx**: 
   - Fetches deck statistics including `dueCards` but doesn't display them
   - No direct "Review" button for starting reviews from deck list
   - Users forced to go through CardBrowser to start reviews

3. **Poor UX in CardBrowser.tsx**:
   - "Start Learning" button name is unclear
   - No indication of how many cards are due for review
   - Button enabled even when no cards are due

## Existing Components Analysis
- **Review.tsx**: Self-contained component with deck selection, works correctly when accessed
- **MainApp.tsx**: State-based routing with navigation handlers, but missing prop passing
- **DeckList.tsx**: Already fetches statistics but doesn't utilize them in UI
- **CardBrowser.tsx**: Has "Start Learning" button but lacks intelligence

# Proposed Solution (Populated by PLAN mode)

## Three-Part Solution Approach

### Part 1: Fix Core Navigation Bug
- Update MainApp.tsx to pass selectedDeckId to Review component
- Modify Review.tsx to accept deckId prop and bypass deck selection when provided

### Part 2: Enhance DeckList UI
- Display card statistics (new, learning, due) on each deck card
- Add prominent "Review" button that's only enabled when cards are due
- Implement direct review access from deck list

### Part 3: Improve CardBrowser Entry Point
- Rename "Start Learning" to "Review Cards" for clarity
- Add due card count to button text
- Disable button when no cards are due

# Implementation Plan (Generated by PLAN mode)

## Implementation Checklist

### Phase 1: Fix MainApp.tsx Navigation Bug ✅
1. [x] Modify renderCurrentPage 'review' case to pass selectedDeckId as deckId prop
2. [x] Add onStartReview prop to DeckList component instance

### Phase 2: Update Review.tsx to Accept deckId ✅
3. [x] Update ReviewProps interface to include deckId?: number | null
4. [x] Modify component signature to accept deckId prop
5. [x] Update initial reviewState to be 'loading' if deckId provided
6. [x] Modify useEffect to call startReview(deckId) when deckId provided

### Phase 3: Enhance DeckList.tsx ✅
7. [x] Update DeckListProps to include onStartReview function
8. [x] Add UI section displaying newCards, learningCards, dueCards with colors
9. [x] Add "复习" (Review) button to each deck card
10. [x] Implement onClick handler with e.stopPropagation()
11. [x] Disable Review button when deck.statistics.dueCards === 0

### Phase 4: Improve CardBrowser.tsx ✅
12. [x] Rename "Start Learning" button to "Review Cards"
13. [x] Fetch and display due card count on button
14. [x] Disable button when no due cards available

### Phase 5: Final Verification ✅
15. [x] Test DeckList review flow (direct deck review)
16. [x] Test CardBrowser review flow (deck-specific review)
17. [x] Test main navigation review button (deck selection)
18. [x] Build and verify no errors
19. [x] Create implementation summary document

**Priority**: P0 Critical (Blocks core functionality)
**Estimated Time**: 2-3 hours
**Risk Level**: Low (Well-defined changes to existing components)
**Dependencies**: Existing Review.tsx, API methods, deck statistics 