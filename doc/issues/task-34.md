# 对话摘要：实现由AI驱动的批量制卡功能

## 任务背景
用户要求实现一个由AI驱动的批量制卡功能。核心需求包括：
1.  用户能够输入并配置自己的Gemini API密钥。
2.  AI能够自动检测并处理双语文本，进行智能对齐。
3.  系统能将处理后的句子对批量转换为学习卡片。
4.  清理不相关的代码，保持项目简洁性。

## 问题分析与焦点转移
在初步分析中，我发现了一些阻碍开发的问题：
-   核心的AI服务文件 (`aiService.ts`, `useAIService.ts`) 已被删除。
-   后端的 `BULK_CREATE_NOTES` 数据处理流程中断。
-   批量导入功能本身存在逻辑错误。

在讨论后，我们将任务焦点集中在解决以下三个具体问题上：
1.  **AI自动分句功能缺失**：当前实现无法将大段文本自动切分为句子对。
2.  **导入功能失效**：点击“导入”按钮后，没有卡片被创建。
3.  **API密钥验证困难**：如何有效验证用户输入的Gemini API密钥并提供反馈。

## 解决方案与执行
为了解决上述问题，我制定并开始执行以下计划：
1.  **重新实现AI服务**：创建 `src/shared/services/geminiService.ts` 文件，专门用于处理与Gemini API的交互，包括文本处理和验证。
2.  **修复数据流**：在 `src/background/index.ts` 中，修正 `AI_PROCESS_TEXT` 和 `BULK_CREATE_NOTES` 的消息处理器，以正确调用新的 `geminiService` 并处理其返回的数据。
3.  **集成与测试**：在前端逐步集成AI服务，并准备编写端到端测试来验证整个批量导入流程的正确性。

目前，`geminiService.ts` 的基础框架已经搭建，后台消息处理器的逻辑也已初步更新，为接下来的功能实现和测试奠定了基础。