# Context
Filename: task-53-fix-review-ts-errors.md
Created On: 2025-01-27
Created By: AI Assistant
Associated Protocol: RIPER-5 + Multidimensional + Agent Protocol

# Task Description
修复 `src/main/pages/Review.tsx` 中的 TypeScript 编译错误。在执行 `npm run build` 时出现两个 TS6133 错误：
1. `selectedDeckId` 变量已声明但从未被读取
2. `setCardsForEvaluation` 变量已声明但从未被读取

这些错误表明代码中存在未使用的变量和过时的功能代码，需要进行清理以提高代码质量和可维护性。

# Project Overview
LanGear 是一个基于 TypeScript + React + Vite 的语言学习应用，采用双相学习系统（任务阶段 + 复习阶段）。当前 Review.tsx 是核心复习界面组件，经过多次重构后积累了一些过时的状态变量和死代码，导致 TypeScript 编译警告。

---
*The following sections are maintained by the AI during protocol execution*
---

# Analysis (Populated by RESEARCH mode)
通过代码分析发现：

## 未使用变量分析
1. **`selectedDeckId` 状态变量**：
   - 在 `startReview` 和 `resetReview` 函数中被设置
   - 但其值从未在组件的任何地方被读取使用
   - 组件逻辑直接使用从 props 或函数参数传入的 `deckId`
   - 结论：完全冗余，可以安全移除

2. **`setCardsForEvaluation` setter**：
   - 从未被调用，表明相关功能已废弃
   - `cardsForEvaluation` 状态仅在 `renderEvaluation` 和 `handleEvaluationComplete` 中使用
   - 这些函数与 `reviewState` 的 `'evaluation'` 状态相关
   - 整个 `'evaluation'` 流程已被新的 `'task-question'` 和 `'task-evaluation'` 流程取代
   - 结论：整个旧评估系统可以安全移除

## 相关死代码识别
- `showTranslation` 状态：仅在废弃的评估流程中使用
- `evaluationIndex` 状态：同上
- `handleShowTranslation` 函数：仅服务于废弃功能
- `handleEvaluationComplete` 函数：同上  
- `renderEvaluation` 函数：整个函数已无用

# Proposed Solution (Populated by INNOVATE mode)
采用渐进式清理方案：

## 方案选择
1. **激进清理**：一次性删除所有相关代码
2. **渐进清理**：分阶段移除，每步验证 ✅ 选择此方案
3. **保守重构**：保留代码但注释掉

## 选择理由
渐进清理方案能够：
- 确保每个修改步骤的安全性
- 便于问题定位和回滚
- 提供清晰的修改记录
- 减少引入回归bug的风险

# Implementation Plan (Generated by PLAN mode)

## Phase 1: 移除核心未使用状态变量
1. **Task 1.1**: 移除 `selectedDeckId` 状态声明
2. **Task 1.2**: 从 `startReview` 函数中移除 `setSelectedDeckId` 调用
3. **Task 1.3**: 从 `resetReview` 函数中移除 `setSelectedDeckId` 调用
4. **Task 1.4**: 验证修改并运行测试

## Phase 2: 清理废弃的评估系统
5. **Task 2.1**: 移除 `cardsForEvaluation` 状态声明
6. **Task 2.2**: 移除 `showTranslation` 状态声明  
7. **Task 2.3**: 移除 `evaluationIndex` 状态声明
8. **Task 2.4**: 验证修改并运行测试

## Phase 3: 删除相关死代码函数
9. **Task 3.1**: 删除 `handleShowTranslation` 函数
10. **Task 3.2**: 删除 `handleEvaluationComplete` 函数
11. **Task 3.3**: 删除 `renderEvaluation` 函数
12. **Task 3.4**: 验证修改并运行测试

## Phase 4: 更新类型定义和控制流
13. **Task 4.1**: 从 `ReviewState` 类型中移除 `'evaluation'`
14. **Task 4.2**: 从 `renderCurrentState` 中移除 `case 'evaluation'` 分支
15. **Task 4.3**: 验证修改并运行测试

## Phase 5: 最终验证和清理
16. **Task 5.1**: 运行 `npm run build` 确认无 TS 错误
17. **Task 5.2**: 手动测试复习流程功能完整性
18. **Task 5.3**: 删除所有测试文件保持代码空间整洁
19. **Task 5.4**: 创建完成总结文档 