import{c as M,r as c,j as e,R as Le,a as ze,C as Ae,S as ge}from"./globals-CJoeM3h1.js";import{A as ie,a as ae,P as re,B as _}from"./api-B8AZkm2R.js";import{S as Pe}from"./save-89HHAFl-.js";import"./_commonjsHelpers-BosuxZz1.js";/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=M("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=M("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=M("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=M("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=M("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=M("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=M("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=M("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=M("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=M("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=M("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=M("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=M("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=M("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=M("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=M("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=M("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=M("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=M("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);let Xe={data:""},Ze=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||Xe,Je=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Ye=/\/\*[^]*?\*\/|  +/g,be=/\n+/g,V=(t,s)=>{let n="",a="",h="";for(let r in t){let p=t[r];r[0]=="@"?r[1]=="i"?n=r+" "+p+";":a+=r[1]=="f"?V(p,r):r+"{"+V(p,r[1]=="k"?"":s)+"}":typeof p=="object"?a+=V(p,s?s.replace(/([^,])+/g,l=>r.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,o=>/&/.test(o)?o.replace(/&/g,l):l?l+" "+o:o)):r):p!=null&&(r=/^--/.test(r)?r:r.replace(/[A-Z]/g,"-$&").toLowerCase(),h+=V.p?V.p(r,p):r+":"+p+";")}return n+(s&&h?s+"{"+h+"}":h)+a},B={},Ce=t=>{if(typeof t=="object"){let s="";for(let n in t)s+=n+Ce(t[n]);return s}return t},Ke=(t,s,n,a,h)=>{let r=Ce(t),p=B[r]||(B[r]=(o=>{let m=0,x=11;for(;m<o.length;)x=101*x+o.charCodeAt(m++)>>>0;return"go"+x})(r));if(!B[p]){let o=r!==t?t:(m=>{let x,C,N=[{}];for(;x=Je.exec(m.replace(Ye,""));)x[4]?N.shift():x[3]?(C=x[3].replace(be," ").trim(),N.unshift(N[0][C]=N[0][C]||{})):N[0][x[1]]=x[2].replace(be," ").trim();return N[0]})(t);B[p]=V(h?{["@keyframes "+p]:o}:o,n?"":"."+p)}let l=n&&B.g?B.g:null;return n&&(B.g=B[p]),((o,m,x,C)=>{C?m.data=m.data.replace(C,o):m.data.indexOf(o)===-1&&(m.data=x?o+m.data:m.data+o)})(B[p],s,a,l),p},Qe=(t,s,n)=>t.reduce((a,h,r)=>{let p=s[r];if(p&&p.call){let l=p(n),o=l&&l.props&&l.props.className||/^go/.test(l)&&l;p=o?"."+o:l&&typeof l=="object"?l.props?"":V(l,""):l===!1?"":l}return a+h+(p??"")},"");function ce(t){let s=this||{},n=t.call?t(s.p):t;return Ke(n.unshift?n.raw?Qe(n,[].slice.call(arguments,1),s.p):n.reduce((a,h)=>Object.assign(a,h&&h.call?h(s.p):h),{}):n,Ze(s.target),s.g,s.o,s.k)}let ke,de,me;ce.bind({g:1});let I=ce.bind({k:1});function et(t,s,n,a){V.p=s,ke=t,de=n,me=a}function G(t,s){let n=this||{};return function(){let a=arguments;function h(r,p){let l=Object.assign({},r),o=l.className||h.className;n.p=Object.assign({theme:de&&de()},l),n.o=/ *go\d+/.test(o),l.className=ce.apply(n,a)+(o?" "+o:"");let m=t;return t[0]&&(m=l.as||t,delete l.as),me&&m[0]&&me(l),ke(m,l)}return h}}var tt=t=>typeof t=="function",ne=(t,s)=>tt(t)?t(s):t,st=(()=>{let t=0;return()=>(++t).toString()})(),De=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let s=matchMedia("(prefers-reduced-motion: reduce)");t=!s||s.matches}return t}})(),at=20,Se=(t,s)=>{switch(s.type){case 0:return{...t,toasts:[s.toast,...t.toasts].slice(0,at)};case 1:return{...t,toasts:t.toasts.map(r=>r.id===s.toast.id?{...r,...s.toast}:r)};case 2:let{toast:n}=s;return Se(t,{type:t.toasts.find(r=>r.id===n.id)?1:0,toast:n});case 3:let{toastId:a}=s;return{...t,toasts:t.toasts.map(r=>r.id===a||a===void 0?{...r,dismissed:!0,visible:!1}:r)};case 4:return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==s.toastId)};case 5:return{...t,pausedAt:s.time};case 6:let h=s.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(r=>({...r,pauseDuration:r.pauseDuration+h}))}}},se=[],U={toasts:[],pausedAt:void 0},W=t=>{U=Se(U,t),se.forEach(s=>{s(U)})},rt={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},nt=(t={})=>{let[s,n]=c.useState(U),a=c.useRef(U);c.useEffect(()=>(a.current!==U&&n(U),se.push(n),()=>{let r=se.indexOf(n);r>-1&&se.splice(r,1)}),[]);let h=s.toasts.map(r=>{var p,l,o;return{...t,...t[r.type],...r,removeDelay:r.removeDelay||((p=t[r.type])==null?void 0:p.removeDelay)||t?.removeDelay,duration:r.duration||((l=t[r.type])==null?void 0:l.duration)||t?.duration||rt[r.type],style:{...t.style,...(o=t[r.type])==null?void 0:o.style,...r.style}}});return{...s,toasts:h}},it=(t,s="blank",n)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:s,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...n,id:n?.id||st()}),K=t=>(s,n)=>{let a=it(s,t,n);return W({type:2,toast:a}),a.id},L=(t,s)=>K("blank")(t,s);L.error=K("error");L.success=K("success");L.loading=K("loading");L.custom=K("custom");L.dismiss=t=>{W({type:3,toastId:t})};L.remove=t=>W({type:4,toastId:t});L.promise=(t,s,n)=>{let a=L.loading(s.loading,{...n,...n?.loading});return typeof t=="function"&&(t=t()),t.then(h=>{let r=s.success?ne(s.success,h):void 0;return r?L.success(r,{id:a,...n,...n?.success}):L.dismiss(a),h}).catch(h=>{let r=s.error?ne(s.error,h):void 0;r?L.error(r,{id:a,...n,...n?.error}):L.dismiss(a)}),t};var lt=(t,s)=>{W({type:1,toast:{id:t,height:s}})},ct=()=>{W({type:5,time:Date.now()})},J=new Map,ot=1e3,dt=(t,s=ot)=>{if(J.has(t))return;let n=setTimeout(()=>{J.delete(t),W({type:4,toastId:t})},s);J.set(t,n)},mt=t=>{let{toasts:s,pausedAt:n}=nt(t);c.useEffect(()=>{if(n)return;let r=Date.now(),p=s.map(l=>{if(l.duration===1/0)return;let o=(l.duration||0)+l.pauseDuration-(r-l.createdAt);if(o<0){l.visible&&L.dismiss(l.id);return}return setTimeout(()=>L.dismiss(l.id),o)});return()=>{p.forEach(l=>l&&clearTimeout(l))}},[s,n]);let a=c.useCallback(()=>{n&&W({type:6,time:Date.now()})},[n]),h=c.useCallback((r,p)=>{let{reverseOrder:l=!1,gutter:o=8,defaultPosition:m}=p||{},x=s.filter(y=>(y.position||m)===(r.position||m)&&y.height),C=x.findIndex(y=>y.id===r.id),N=x.filter((y,D)=>D<C&&y.visible).length;return x.filter(y=>y.visible).slice(...l?[N+1]:[0,N]).reduce((y,D)=>y+(D.height||0)+o,0)},[s]);return c.useEffect(()=>{s.forEach(r=>{if(r.dismissed)dt(r.id,r.removeDelay);else{let p=J.get(r.id);p&&(clearTimeout(p),J.delete(r.id))}})},[s]),{toasts:s,handlers:{updateHeight:lt,startPause:ct,endPause:a,calculateOffset:h}}},xt=I`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,pt=I`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,ht=I`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,ut=G("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${xt} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${pt} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${ht} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,yt=I`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,ft=G("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${yt} 1s linear infinite;
`,gt=I`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,bt=I`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,jt=G("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${gt} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${bt} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Nt=G("div")`
  position: absolute;
`,vt=G("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,wt=I`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Ct=G("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${wt} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,kt=({toast:t})=>{let{icon:s,type:n,iconTheme:a}=t;return s!==void 0?typeof s=="string"?c.createElement(Ct,null,s):s:n==="blank"?null:c.createElement(vt,null,c.createElement(ft,{...a}),n!=="loading"&&c.createElement(Nt,null,n==="error"?c.createElement(ut,{...a}):c.createElement(jt,{...a})))},Dt=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,St=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,Et="0%{opacity:0;} 100%{opacity:1;}",$t="0%{opacity:1;} 100%{opacity:0;}",Rt=G("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Mt=G("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Tt=(t,s)=>{let n=t.includes("top")?1:-1,[a,h]=De()?[Et,$t]:[Dt(n),St(n)];return{animation:s?`${I(a)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${I(h)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Ft=c.memo(({toast:t,position:s,style:n,children:a})=>{let h=t.height?Tt(t.position||s||"top-center",t.visible):{opacity:0},r=c.createElement(kt,{toast:t}),p=c.createElement(Mt,{...t.ariaProps},ne(t.message,t));return c.createElement(Rt,{className:t.className,style:{...h,...n,...t.style}},typeof a=="function"?a({icon:r,message:p}):c.createElement(c.Fragment,null,r,p))});et(c.createElement);var Lt=({id:t,className:s,style:n,onHeightUpdate:a,children:h})=>{let r=c.useCallback(p=>{if(p){let l=()=>{let o=p.getBoundingClientRect().height;a(t,o)};l(),new MutationObserver(l).observe(p,{subtree:!0,childList:!0,characterData:!0})}},[t,a]);return c.createElement("div",{ref:r,className:s,style:n},h)},zt=(t,s)=>{let n=t.includes("top"),a=n?{top:0}:{bottom:0},h=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:De()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${s*(n?1:-1)}px)`,...a,...h}},At=ce`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,te=16,Pt=({reverseOrder:t,position:s="top-center",toastOptions:n,gutter:a,children:h,containerStyle:r,containerClassName:p})=>{let{toasts:l,handlers:o}=mt(n);return c.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:te,left:te,right:te,bottom:te,pointerEvents:"none",...r},className:p,onMouseEnter:o.startPause,onMouseLeave:o.endPause},l.map(m=>{let x=m.position||s,C=o.calculateOffset(m,{reverseOrder:t,gutter:a,defaultPosition:s}),N=zt(x,C);return c.createElement(Lt,{id:m.id,key:m.id,onHeightUpdate:o.updateHeight,className:m.visible?At:"",style:N},m.type==="custom"?ne(m.message,m):h?h(m):c.createElement(Ft,{toast:m,position:x}))}))},P=L;const je=({onDeckSelect:t,onCreateNote:s,onStartReview:n})=>{const[a,h]=c.useState([]),[r,p]=c.useState(!0),[l,o]=c.useState(!1),[m,x]=c.useState(!1),[C,N]=c.useState(!1),[y,D]=c.useState(null),[i,f]=c.useState({name:"",description:""}),v=new ie;c.useEffect(()=>{k()},[]);const k=async()=>{try{p(!0);const d=await v.getAllDecks(),g=await Promise.all(d.map(async R=>{try{const $=await v.getDeckStatistics(R.id);return{...R,statistics:$}}catch($){return console.error(`Failed to load statistics for deck ${R.id}:`,$),R}}));h(g)}catch(d){console.error("Failed to load decks:",d)}finally{p(!1)}},u=async()=>{if(i.name.trim())try{await v.createDeck({name:i.name.trim(),description:i.description.trim()||void 0}),await k(),P.success("牌组创建成功！"),E(),o(!1)}catch(d){console.error("Failed to create deck:",d),P.error("创建牌组失败，请重试")}},w=async()=>{if(!(!y||!i.name.trim()))try{await v.updateDeck(y.id,{name:i.name.trim(),description:i.description.trim()||void 0}),await k(),P.success("牌组更新成功！"),E(),x(!1),D(null)}catch(d){console.error("Failed to update deck:",d),P.error("更新牌组失败，请重试")}},F=async()=>{if(y)try{await v.deleteDeck(y.id),await k(),P.success("牌组删除成功！"),N(!1),D(null)}catch(d){console.error("Failed to delete deck:",d),P.error("删除牌组失败，请重试")}},E=()=>{f({name:"",description:""})},S=()=>{E(),o(!0)},b=d=>{D(d),f({name:d.name,description:d.description||""}),x(!0)},A=d=>{D(d),N(!0)};return r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3 text-primary-600",children:[e.jsx(ae,{className:"w-6 h-6 animate-pulse"}),e.jsx("span",{className:"text-lg font-medium",children:"加载牌组中..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-900",children:"我的牌组"}),e.jsxs("p",{className:"text-primary-600 mt-1",children:["共 ",a.length," 个牌组，",a.reduce((d,g)=>d+(g.statistics?.totalCards||0),0)," 张卡片"]})]}),e.jsxs("button",{onClick:S,className:"btn-accent flex items-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"创建牌组"})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(_,{className:"w-20 h-20 mx-auto text-primary-400 mb-6"}),e.jsx("h3",{className:"text-xl font-semibold text-primary-900 mb-3",children:"暂无牌组"}),e.jsx("p",{className:"text-primary-600 mb-8 max-w-md mx-auto",children:"创建您的第一个牌组开始学习之旅。牌组可以帮助您组织和管理学习内容。"}),e.jsx("button",{onClick:S,className:"btn-primary",children:"创建第一个牌组"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(d=>e.jsxs("div",{className:"card-industrial-hover p-6 group cursor-pointer",onClick:()=>t?.(d.id),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"text-lg font-semibold text-primary-900 truncate mb-1",children:d.name})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded",children:"Basic"}),e.jsxs("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),s?.(d.id)},className:"p-2 text-accent-500 hover:text-accent-600 hover:bg-accent-100 rounded-lg transition-colors",title:"新建卡片",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),b(d)},className:"p-2 text-primary-500 hover:text-accent-600 hover:bg-primary-100 rounded-lg transition-colors",title:"编辑牌组",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),A(d)},className:"p-2 text-primary-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"删除牌组",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"mb-4",children:[d.description?e.jsx("p",{className:"text-primary-600 text-sm leading-relaxed mb-3",children:d.description}):e.jsx("p",{className:"text-primary-500 text-sm italic mb-3",children:"暂无描述信息"}),d.statistics&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:"新卡片"}),e.jsx("div",{className:"text-sm font-bold text-blue-800",children:d.statistics.newCards||0})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-xs text-orange-600 font-medium",children:"学习中"}),e.jsx("div",{className:"text-sm font-bold text-orange-800",children:d.statistics.learningCards||0})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-xs text-green-600 font-medium",children:"待复习"}),e.jsx("div",{className:"text-sm font-bold text-green-800",children:d.statistics.dueCards||0})]})]}),e.jsxs("button",{onClick:g=>{g.stopPropagation(),n?.(d.id)},disabled:!d.statistics.dueCards||d.statistics.dueCards===0,className:`w-full py-2 px-4 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2 ${d.statistics.dueCards&&d.statistics.dueCards>0?"bg-accent-500 hover:bg-accent-600 text-white":"bg-primary-200 text-primary-500 cursor-not-allowed"}`,title:d.statistics.dueCards&&d.statistics.dueCards>0?"开始复习":"暂无到期卡片",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:d.statistics.dueCards&&d.statistics.dueCards>0?`复习 (${d.statistics.dueCards})`:"暂无复习"})]})]})]}),e.jsx("div",{className:"pt-4 border-t border-primary-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-primary-500",children:["创建于 ",new Date(d.createdAt).toLocaleDateString()]}),e.jsx("div",{className:"flex items-center space-x-1 text-xs text-primary-600",children:e.jsx("span",{children:"中文 → English"})})]})})]},d.id))}),l&&e.jsx("div",{className:"modal-overlay",onClick:()=>o(!1),children:e.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-900",children:"创建新牌组"}),e.jsx("button",{onClick:()=>o(!1),className:"text-primary-500 hover:text-primary-700",children:"✕"})]}),e.jsxs("div",{className:"modal-body space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-2",children:"牌组名称 *"}),e.jsx("input",{type:"text",value:i.name,onChange:d=>f(g=>({...g,name:d.target.value})),placeholder:"输入牌组名称",className:"input-industrial",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-2",children:"描述（可选）"}),e.jsx("textarea",{value:i.description,onChange:d=>f(g=>({...g,description:d.target.value})),placeholder:"输入牌组描述",rows:3,className:"input-industrial resize-none"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:()=>o(!1),className:"btn-secondary",children:"取消"}),e.jsx("button",{onClick:u,disabled:!i.name.trim(),className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"创建"})]})]})}),m&&y&&e.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:e.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-900",children:"编辑牌组"}),e.jsx("button",{onClick:()=>x(!1),className:"text-primary-500 hover:text-primary-700",children:"✕"})]}),e.jsxs("div",{className:"modal-body space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-2",children:"牌组名称 *"}),e.jsx("input",{type:"text",value:i.name,onChange:d=>f(g=>({...g,name:d.target.value})),placeholder:"输入牌组名称",className:"input-industrial",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-2",children:"描述（可选）"}),e.jsx("textarea",{value:i.description,onChange:d=>f(g=>({...g,description:d.target.value})),placeholder:"输入牌组描述",rows:3,className:"input-industrial resize-none"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:()=>x(!1),className:"btn-secondary",children:"取消"}),e.jsx("button",{onClick:w,disabled:!i.name.trim(),className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"保存"})]})]})}),C&&y&&e.jsx("div",{className:"modal-overlay",onClick:()=>N(!1),children:e.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900",children:"删除牌组"}),e.jsx("button",{onClick:()=>N(!1),className:"text-primary-500 hover:text-primary-700",children:"✕"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Y,{className:"w-8 h-8 text-red-500"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-primary-900 mb-2",children:["确定要删除牌组 ",e.jsxs("strong",{children:['"',y.name,'"']})," 吗？"]}),e.jsx("p",{className:"text-sm text-primary-600",children:"此操作将永久删除牌组中的所有卡片和学习记录，且无法撤销。"})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:()=>N(!1),className:"btn-secondary",children:"取消"}),e.jsx("button",{onClick:F,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-industrial font-medium transition-colors",children:"删除"})]})]})})]})},Ht=({deckId:t,noteId:s,noteType:n,onBack:a,onNoteSaved:h})=>{const[r,p]=c.useState(n),[l,o]=c.useState(!n&&!s),[m,x]=c.useState({chinese:"",english:"",pinyin:"",notes:""}),[C,N]=c.useState(!1),[y,D]=c.useState(!1),[i,f]=c.useState({}),v=new ie,k=!!s;c.useEffect(()=>{s&&u()},[s]);const u=async()=>{try{D(!0);const b=await v.getNoteById(s);p(b.noteType),o(!1),b.noteType==="CtoE"&&b.fields.CtoE&&x({chinese:b.fields.CtoE.chinese||"",english:b.fields.CtoE.english||"",pinyin:b.fields.CtoE.pinyin||"",notes:b.fields.CtoE.notes||""})}catch(b){console.error("Failed to load note:",b),alert("加载笔记失败，请重试")}finally{D(!1)}},w=()=>{const b={};return m.chinese.trim()||(b.chinese="请输入原文内容"),m.english.trim()||(b.english="请输入翻译内容"),f(b),Object.keys(b).length===0},F=async()=>{if(r&&!(r==="CtoE"&&!w())){N(!0);try{let b={};if(r==="CtoE"&&(b.CtoE={chinese:m.chinese.trim(),english:m.english.trim(),pinyin:m.pinyin.trim()||void 0,notes:m.notes.trim()||void 0}),k){const A={fields:b,tags:[]};await v.updateNote(s,A),alert("笔记更新成功！")}else{const A={deckId:t,noteType:r,fields:b,tags:[]};await v.createNote(A),r==="CtoE"&&x({chinese:"",english:"",pinyin:"",notes:""}),alert("笔记创建成功！")}f({}),h?.()}catch(b){console.error(`Failed to ${k?"update":"create"} note:`,b),alert(`${k?"更新":"创建"}笔记失败，请重试`)}finally{N(!1)}}},E=(b,A)=>{x(d=>({...d,[b]:A})),i[b]&&f(d=>({...d,[b]:""}))},S=b=>{p(b),o(!1),f({})};return y?e.jsx("div",{className:"min-h-screen bg-primary-50 flex items-center justify-center",children:e.jsx("div",{className:"text-primary-600",children:"加载中..."})}):l&&!k?e.jsx("div",{className:"min-h-screen bg-primary-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 text-primary-600 hover:text-primary-700 transition-colors",children:[e.jsx(Z,{size:20}),"返回"]}),e.jsx("div",{className:"w-px h-6 bg-primary-300"}),e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:"选择笔记类型"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("button",{onClick:()=>S("CtoE"),className:"bg-white rounded-lg p-6 border-2 border-primary-200 hover:border-accent-500 hover:shadow-lg transition-all duration-200 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(_,{className:"text-accent-500",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-primary-900",children:"中英对照"})]}),e.jsx("p",{className:"text-primary-600 text-sm",children:"适合学习中英文对照内容，支持拼音标注和个人笔记"})]}),e.jsxs("button",{onClick:()=>S("Retranslate"),className:"bg-white rounded-lg p-6 border-2 border-primary-200 hover:border-accent-500 hover:shadow-lg transition-all duration-200 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(le,{className:"text-accent-500",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-primary-900",children:"重译练习"})]}),e.jsx("p",{className:"text-primary-600 text-sm",children:"通过重新翻译原文来练习语言技能"})]}),e.jsxs("button",{onClick:()=>S("SentenceParaphrase"),className:"bg-white rounded-lg p-6 border-2 border-primary-200 hover:border-accent-500 hover:shadow-lg transition-all duration-200 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ie,{className:"text-accent-500",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-primary-900",children:"句子复述"})]}),e.jsx("p",{className:"text-primary-600 text-sm",children:"练习听写和复述，提高语音理解能力"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-primary-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 text-primary-600 hover:text-primary-700 transition-colors",children:[e.jsx(Z,{size:20}),"返回"]}),e.jsx("div",{className:"w-px h-6 bg-primary-300"}),e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:k?"编辑笔记":"创建笔记"}),r&&e.jsx("span",{className:"px-3 py-1 bg-accent-100 text-accent-700 rounded-full text-sm font-medium",children:r==="CtoE"?"中英对照":r})]}),r==="CtoE"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-industrial border border-primary-200",children:[e.jsx("div",{className:"p-6 border-b border-primary-200",children:e.jsxs("h2",{className:"text-lg font-semibold text-primary-900 flex items-center gap-2",children:[e.jsx(_,{size:20,className:"text-accent-500"}),"中英对照笔记"]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-2",children:"原文内容 *"}),e.jsx("textarea",{value:m.chinese,onChange:b=>E("chinese",b.target.value),placeholder:"请输入中文原文...",className:`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500 focus:border-transparent resize-none h-24 ${i.chinese?"border-red-500":"border-primary-300"}`}),i.chinese&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.chinese})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-2",children:"英文翻译 *"}),e.jsx("textarea",{value:m.english,onChange:b=>E("english",b.target.value),placeholder:"请输入英文翻译...",className:`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500 focus:border-transparent resize-none h-24 ${i.english?"border-red-500":"border-primary-300"}`}),i.english&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.english})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-2",children:"拼音标注 (可选)"}),e.jsx("input",{type:"text",value:m.pinyin,onChange:b=>E("pinyin",b.target.value),placeholder:"请输入拼音...",className:"w-full px-3 py-2 border border-primary-300 rounded-md focus:ring-2 focus:ring-accent-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-2",children:"个人笔记 (可选)"}),e.jsx("textarea",{value:m.notes,onChange:b=>E("notes",b.target.value),placeholder:"请输入个人笔记或备注...",className:"w-full px-3 py-2 border border-primary-300 rounded-md focus:ring-2 focus:ring-accent-500 focus:border-transparent resize-none h-32"})]})]}),e.jsx("div",{className:"px-6 py-4 bg-primary-50 border-t border-primary-200 flex justify-end",children:e.jsxs("button",{onClick:F,disabled:C,className:"flex items-center gap-2 bg-accent-500 text-white px-6 py-2 rounded-md hover:bg-accent-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(Pe,{size:16}),C?"保存中...":k?"更新笔记":"创建笔记"]})})]})]})})},Ot=({deckId:t,onBack:s})=>{const[n,a]=c.useState(t?"loading":"deck-selection"),[h,r]=c.useState(null),[p,l]=c.useState([]),[o,m]=c.useState([]),[x,C]=c.useState(0),[N,y]=c.useState(0),D=new ie;c.useEffect(()=>{t?f(t):i()},[t]);const i=async()=>{try{const g=await D.getAllDecks();l(g)}catch(g){console.error("Failed to load decks:",g)}},f=async(g=null)=>{a("loading"),r(g);try{const R=await D.getDueCards(g||void 0,20);if(R.length===0){a("no-cards");return}const $=[];for(const O of R)try{const H=await D.getNoteById(O.noteId);H&&$.push({...O,note:H})}catch(H){console.error(`Failed to load note for card ${O.id}:`,H)}$.length>0?(m($),C(0),y(0),a("question")):a("no-cards")}catch(R){console.error("Failed to start review:",R),alert("启动复习失败，请重试"),a("deck-selection")}},v=()=>{a("answer")},k=async g=>{const R=o[x];if(R)try{await D.reviewCard(R.id,g==="Again"?1:g==="Hard"?2:g==="Good"?3:4),y($=>$+1),x<o.length-1?(C($=>$+1),a("question")):a("completed")}catch($){console.error("Failed to submit rating:",$),alert("提交评分失败，请重试")}},u=()=>{a("deck-selection"),r(null),m([]),C(0),y(0)},w=()=>o[x],F=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-primary-900",children:"选择复习内容"}),e.jsx("p",{className:"text-primary-600 mt-1",children:"选择要复习的牌组或复习所有到期卡片"})]}),s&&e.jsxs("button",{onClick:s,className:"flex items-center space-x-2 text-primary-600 hover:text-primary-700 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"返回"})]})]}),e.jsx("div",{className:"card-industrial p-6 hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>f(null),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-900 mb-2",children:"复习所有到期卡片"}),e.jsx("p",{className:"text-primary-600",children:"复习所有牌组中的到期卡片"})]}),e.jsx("div",{className:"text-accent-600",children:e.jsx(ee,{className:"w-8 h-8"})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-900",children:"或选择特定牌组"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:p.map(g=>e.jsxs("div",{className:"card-industrial p-4 hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>f(g.id),children:[e.jsx("h4",{className:"font-semibold text-primary-900 mb-1",children:g.name}),g.description&&e.jsx("p",{className:"text-sm text-primary-600 mb-2",children:g.description}),e.jsx("div",{className:"text-xs text-primary-500",children:"点击开始复习此牌组"})]},g.id))})]})]}),E=()=>e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"flex items-center justify-center space-x-3 text-primary-600",children:[e.jsx(he,{className:"w-8 h-8 animate-spin"}),e.jsx("span",{className:"text-lg font-medium",children:"正在加载复习卡片..."})]})}),S=()=>e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ee,{className:"w-16 h-16 mx-auto text-green-500 mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-primary-900 mb-2",children:"暂无到期卡片"}),e.jsxs("p",{className:"text-primary-600 mb-6",children:[h?"该牌组":"所有牌组","中暂时没有需要复习的卡片"]}),e.jsx("button",{onClick:u,className:"btn-primary",children:"重新选择"})]}),b=()=>{const g=w();if(!g)return null;const R=g.note.fields.CtoE?.chinese||"内容加载失败",$=g.note.fields.CtoE?.pinyin;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:u,className:"flex items-center space-x-2 text-primary-600 hover:text-primary-700 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"重新选择"})]}),e.jsx("div",{className:"h-6 w-px bg-primary-300"}),e.jsxs("div",{className:"text-sm text-primary-600",children:[x+1," / ",o.length]})]}),e.jsx("div",{className:"flex items-center space-x-2 text-sm text-primary-600",children:e.jsxs("span",{children:["已完成: ",N]})})]}),e.jsx("div",{className:"w-full bg-primary-200 rounded-full h-2",children:e.jsx("div",{className:"bg-accent-500 h-2 rounded-full transition-all duration-300",style:{width:`${x/o.length*100}%`}})}),e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"card-industrial p-8 text-center bg-gradient-to-br from-primary-50 to-accent-50 border-2 border-accent-200",children:[e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:"text-sm font-medium text-primary-600 mb-2",children:"请翻译下面的中文"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-3xl font-bold text-primary-900 leading-relaxed",children:R}),$&&e.jsx("p",{className:"text-lg text-primary-600 font-medium",children:$})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:v,className:"btn-accent text-lg px-8 py-3",children:"显示答案"})})]})})]})},A=()=>{const g=w();if(!g)return null;const R=g.note.fields.CtoE?.chinese||"内容加载失败",$=g.note.fields.CtoE?.english||"翻译加载失败",O=g.note.fields.CtoE?.notes,H=g.note.fields.CtoE?.pinyin;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:u,className:"flex items-center space-x-2 text-primary-600 hover:text-primary-700 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"重新选择"})]}),e.jsx("div",{className:"h-6 w-px bg-primary-300"}),e.jsxs("div",{className:"text-sm text-primary-600",children:[x+1," / ",o.length]})]}),e.jsx("div",{className:"flex items-center space-x-2 text-sm text-primary-600",children:e.jsxs("span",{children:["已完成: ",N]})})]}),e.jsx("div",{className:"w-full bg-primary-200 rounded-full h-2",children:e.jsx("div",{className:"bg-accent-500 h-2 rounded-full transition-all duration-300",style:{width:`${x/o.length*100}%`}})}),e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"card-industrial p-6 bg-primary-25 border border-primary-200",children:[e.jsx("h4",{className:"text-sm font-medium text-primary-600 mb-2",children:"原文"}),e.jsx("p",{className:"text-xl font-semibold text-primary-900",children:R}),H&&e.jsx("p",{className:"text-md text-primary-600 mt-1",children:H})]}),e.jsxs("div",{className:"card-industrial p-6 bg-accent-25 border border-accent-200",children:[e.jsx("h4",{className:"text-sm font-medium text-accent-700 mb-2",children:"参考翻译"}),e.jsx("p",{className:"text-xl font-semibold text-accent-900",children:$}),O&&e.jsxs("div",{className:"mt-4 p-3 bg-accent-50 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-medium text-accent-700 mb-1",children:"学习笔记"}),e.jsx("p",{className:"text-sm text-accent-800",children:O})]})]}),e.jsxs("div",{className:"card-industrial p-6",children:[e.jsx("h4",{className:"text-center text-lg font-semibold text-primary-900 mb-6",children:"请根据你的回答情况评分"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>k("Again"),className:"flex flex-col items-center p-4 rounded-lg border-2 border-red-200 hover:border-red-400 hover:bg-red-50 transition-colors",children:[e.jsx(Be,{className:"w-8 h-8 text-red-500 mb-2"}),e.jsx("span",{className:"font-medium text-red-700",children:"Again"}),e.jsx("span",{className:"text-xs text-red-600 text-center",children:"完全不会"})]}),e.jsxs("button",{onClick:()=>k("Hard"),className:"flex flex-col items-center p-4 rounded-lg border-2 border-yellow-200 hover:border-yellow-400 hover:bg-yellow-50 transition-colors",children:[e.jsx(Ue,{className:"w-8 h-8 text-yellow-500 mb-2"}),e.jsx("span",{className:"font-medium text-yellow-700",children:"Hard"}),e.jsx("span",{className:"text-xs text-yellow-600 text-center",children:"困难"})]}),e.jsxs("button",{onClick:()=>k("Good"),className:"flex flex-col items-center p-4 rounded-lg border-2 border-green-200 hover:border-green-400 hover:bg-green-50 transition-colors",children:[e.jsx(ee,{className:"w-8 h-8 text-green-500 mb-2"}),e.jsx("span",{className:"font-medium text-green-700",children:"Good"}),e.jsx("span",{className:"text-xs text-green-600 text-center",children:"良好"})]}),e.jsxs("button",{onClick:()=>k("Easy"),className:"flex flex-col items-center p-4 rounded-lg border-2 border-blue-200 hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[e.jsx(re,{className:"w-8 h-8 text-blue-500 mb-2"}),e.jsx("span",{className:"font-medium text-blue-700",children:"Easy"}),e.jsx("span",{className:"text-xs text-blue-600 text-center",children:"简单"})]})]}),e.jsx("div",{className:"mt-4 text-xs text-primary-500 text-center",children:"评分会影响下次复习的时间安排"})]})]})]})},d=()=>e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ee,{className:"w-20 h-20 mx-auto text-green-500 mb-6"}),e.jsx("h3",{className:"text-2xl font-bold text-primary-900 mb-4",children:"复习完成！"}),e.jsxs("p",{className:"text-lg text-primary-600 mb-2",children:["本次复习了 ",N," 张卡片"]}),e.jsx("p",{className:"text-primary-500 mb-8",children:"系统已根据你的评分安排下次复习时间"}),e.jsxs("div",{className:"space-x-4",children:[e.jsx("button",{onClick:u,className:"btn-primary",children:"再次复习"}),s&&e.jsx("button",{onClick:s,className:"btn-secondary",children:"返回首页"})]})]});return e.jsxs("div",{className:"space-y-6",children:[n==="deck-selection"&&F(),n==="loading"&&E(),n==="no-cards"&&S(),n==="question"&&b(),n==="answer"&&A(),n==="completed"&&d()]})};function ue(t){if(t instanceof Date)return t;if(typeof t=="string"||typeof t=="number"){const s=new Date(t);return isNaN(s.getTime())?(console.warn("Invalid date value:",t),new Date):s}return console.warn("Invalid date type:",typeof t,t),new Date}function xe(t){const s=ue(t);return`${s.toLocaleDateString("zh-CN")} ${s.toLocaleTimeString("zh-CN")}`}function Bt(t){const s=ue(t),n=new Date,a=s.getTime()-n.getTime();return Math.ceil(a/(1e3*60*60*24))}function Ee(t){return ue(t)<=new Date?"已到期":`${Bt(t)}天后`}const It=({cards:t,onCardClick:s,onEditCard:n,onDeleteCard:a,selectedCards:h=new Set,onSelectCard:r,onSelectAll:p})=>{const[l,o]=c.useState("due"),[m,x]=c.useState("asc"),C=u=>{if(!u.note)return"内容加载中...";const w=u.note.fields;switch(u.cardType){case"CtoE":return w.CtoE?.chinese||"无内容";case"Retranslate":return w.Retranslate?.originalText||"无内容";default:return"未知卡片类型"}},N=u=>{switch(u){case"New":return"bg-blue-100 text-blue-800";case"Learning":return"bg-yellow-100 text-yellow-800";case"Review":return"bg-green-100 text-green-800";case"Relearning":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=u=>{switch(u){case"New":return"新卡片";case"Learning":return"学习中";case"Review":return"复习中";case"Relearning":return"重新学习";default:return u}},D=c.useMemo(()=>[...t].sort((w,F)=>{let E,S;switch(l){case"content":E=C(w).toLowerCase(),S=C(F).toLowerCase();break;case"state":E=w.state,S=F.state;break;case"due":E=new Date(w.due).getTime(),S=new Date(F.due).getTime();break;case"reps":E=w.reps,S=F.reps;break;case"lapses":E=w.lapses,S=F.lapses;break;case"tags":E=w.note?.tags?.join("")||"",S=F.note?.tags?.join("")||"";break;case"created":E=new Date(w.createdAt).getTime(),S=new Date(F.createdAt).getTime();break;default:return 0}return E<S?m==="asc"?-1:1:E>S?m==="asc"?1:-1:0}),[t,l,m]),i=u=>{l===u?x(m==="asc"?"desc":"asc"):(o(u),x("asc"))},f=({field:u,children:w})=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-primary-600 uppercase tracking-wider cursor-pointer hover:bg-primary-100 transition-colors",onClick:()=>i(u),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:w}),l===u?m==="asc"?e.jsx(Oe,{className:"w-4 h-4"}):e.jsx(He,{className:"w-4 h-4"}):e.jsx("div",{className:"w-4 h-4"})]})}),v=t.length>0&&t.every(u=>h.has(u.id)),k=t.some(u=>h.has(u.id));return e.jsxs("div",{className:"bg-white shadow-industrial rounded-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-primary-200",children:[e.jsx("thead",{className:"bg-primary-50",children:e.jsxs("tr",{children:[r&&e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:v,ref:u=>{u&&(u.indeterminate=k&&!v)},onChange:u=>p?.(u.target.checked),className:"rounded border-primary-300 text-accent-600 focus:ring-accent-500"})}),e.jsx(f,{field:"content",children:"内容"}),e.jsx(f,{field:"state",children:"状态"}),e.jsx(f,{field:"due",children:"到期时间"}),e.jsx(f,{field:"tags",children:"标签"}),e.jsx(f,{field:"reps",children:"复习次数"}),e.jsx(f,{field:"lapses",children:"遗忘次数"}),e.jsx(f,{field:"created",children:"创建时间"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-primary-600 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-primary-200",children:D.map(u=>e.jsxs("tr",{className:"hover:bg-primary-50 cursor-pointer transition-colors",onClick:()=>s(u),children:[r&&e.jsx("td",{className:"px-4 py-4",onClick:w=>w.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:h.has(u.id),onChange:w=>r(u.id,w.target.checked),className:"rounded border-primary-300 text-accent-600 focus:ring-accent-500"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm text-primary-900 line-clamp-2 max-w-xs",children:C(u)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N(u.state)}`,children:y(u.state)})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm text-primary-900",children:Ee(u.due)}),e.jsx("div",{className:"text-xs text-primary-500",children:xe(u.due)})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-1 min-h-[24px]",children:u.note?.tags?.map((w,F)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-accent-100 text-accent-800 rounded-full",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),w]},F))||e.jsx("span",{className:"text-xs text-primary-400",children:"无标签"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center text-sm text-primary-900",children:[e.jsx(he,{className:"w-4 h-4 mr-1 text-primary-400"}),u.reps]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm text-primary-900",children:u.lapses})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm text-primary-500",children:xe(u.createdAt)})}),e.jsx("td",{className:"px-4 py-4",onClick:w=>w.stopPropagation(),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[n&&e.jsx("button",{onClick:()=>n(u),className:"p-1 text-primary-500 hover:text-accent-600 hover:bg-primary-100 rounded transition-colors",title:"编辑卡片",children:e.jsx(le,{className:"w-4 h-4"})}),a&&e.jsx("button",{onClick:()=>a(u),className:"p-1 text-primary-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"删除卡片",children:e.jsx(Y,{className:"w-4 h-4"})})]})})]},u.id))})]})}),t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{className:"w-16 h-16 mx-auto text-primary-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-primary-900 mb-2",children:"暂无卡片"}),e.jsx("p",{className:"text-primary-600",children:"没有找到匹配的卡片"})]})]})},Ne=[{value:"New",label:"新卡片",color:"bg-blue-100 text-blue-800"},{value:"Learning",label:"学习中",color:"bg-yellow-100 text-yellow-800"},{value:"Review",label:"复习中",color:"bg-green-100 text-green-800"},{value:"Relearning",label:"重新学习",color:"bg-red-100 text-red-800"}],qt=({cards:t,onFilterChange:s,onFilterStateChange:n})=>{const[a,h]=c.useState({search:"",tags:[],states:[],dueDateRange:{start:"",end:""}}),[r,p]=c.useState(!1),l=Le.useMemo(()=>{const i=new Set;return t.forEach(f=>{f.note?.tags?.forEach(v=>i.add(v))}),Array.from(i).sort()},[t]),o=c.useCallback(i=>{if(!i.note)return"";const f=i.note.fields;let v="";switch(i.cardType){case"CtoE":v=`${f.CtoE?.chinese||""} ${f.CtoE?.english||""}`;break;case"Retranslate":v=`${f.Retranslate?.originalText||""} ${f.Retranslate?.userTranslation||""}`;break;default:v=JSON.stringify(f)}const k=i.note.tags?.join(" ")||"";return`${v} ${k}`.toLowerCase()},[]),m=c.useCallback(()=>{let i=[...t];if(a.search.trim()){const f=a.search.toLowerCase().trim();i=i.filter(v=>o(v).includes(f))}a.tags.length>0&&(i=i.filter(f=>a.tags.every(v=>f.note?.tags?.includes(v)))),a.states.length>0&&(i=i.filter(f=>a.states.includes(f.state))),(a.dueDateRange.start||a.dueDateRange.end)&&(i=i.filter(f=>{const v=new Date(f.due),k=a.dueDateRange.start?new Date(a.dueDateRange.start):null,u=a.dueDateRange.end?new Date(a.dueDateRange.end):null;return!(k&&v<k||u&&v>u)})),s(i)},[t,a,o,s]);c.useEffect(()=>{m(),n?.(a)},[a,m,n]);const x=i=>{h(f=>({...f,...i}))},C=()=>{h({search:"",tags:[],states:[],dueDateRange:{start:"",end:""}})},N=i=>{x({tags:a.tags.includes(i)?a.tags.filter(f=>f!==i):[...a.tags,i]})},y=i=>{x({states:a.states.includes(i)?a.states.filter(f=>f!==i):[...a.states,i]})},D=[a.search.trim()?1:0,a.tags.length,a.states.length,a.dueDateRange.start||a.dueDateRange.end?1:0].reduce((i,f)=>i+f,0);return e.jsxs("div",{className:"bg-white border border-primary-200 rounded-lg p-4 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(We,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-primary-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"搜索卡片内容、标签...",value:a.search,onChange:i=>x({search:i.target.value}),className:"w-full pl-10 pr-4 py-2 border border-primary-300 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500"})]}),e.jsxs("button",{onClick:()=>p(!r),className:`flex items-center space-x-2 px-4 py-2 border rounded-lg transition-colors ${r?"bg-accent-50 border-accent-300 text-accent-700":"border-primary-300 text-primary-600 hover:bg-primary-50"}`,children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:"高级过滤"}),D>0&&e.jsx("span",{className:"bg-accent-500 text-white text-xs px-2 py-1 rounded-full",children:D})]}),D>0&&e.jsxs("button",{onClick:C,className:"flex items-center space-x-2 px-3 py-2 text-red-600 hover:bg-red-50 border border-red-300 rounded-lg transition-colors",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"清除"})]})]}),r&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-primary-200",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-primary-700 mb-2 flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"标签过滤"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.map(i=>e.jsxs("button",{onClick:()=>N(i),className:`inline-flex items-center px-3 py-1 text-sm font-medium rounded-full transition-colors ${a.tags.includes(i)?"bg-accent-100 text-accent-800 border-2 border-accent-300":"bg-primary-100 text-primary-700 border-2 border-transparent hover:border-primary-300"}`,children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),i,a.tags.includes(i)&&e.jsx(X,{className:"w-3 h-3 ml-1"})]},i)),l.length===0&&e.jsx("span",{className:"text-sm text-primary-500",children:"暂无可用标签"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-primary-700 mb-2 flex items-center",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),"卡片状态"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ne.map(i=>e.jsxs("button",{onClick:()=>y(i.value),className:`inline-flex items-center px-3 py-1 text-sm font-medium rounded-full transition-colors border-2 ${a.states.includes(i.value)?`${i.color} border-current`:"bg-primary-100 text-primary-700 border-transparent hover:border-primary-300"}`,children:[i.label,a.states.includes(i.value)&&e.jsx(X,{className:"w-3 h-3 ml-1"})]},i.value))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-primary-700 mb-2 flex items-center",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"到期日期范围"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"date",value:a.dueDateRange.start,onChange:i=>x({dueDateRange:{...a.dueDateRange,start:i.target.value}}),className:"px-3 py-2 border border-primary-300 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500"}),e.jsx("span",{className:"text-primary-500",children:"到"}),e.jsx("input",{type:"date",value:a.dueDateRange.end,onChange:i=>x({dueDateRange:{...a.dueDateRange,end:i.target.value}}),className:"px-3 py-2 border border-primary-300 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500"})]})]})]}),D>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-primary-200",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-primary-600",children:"已应用过滤器:"}),a.search.trim()&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-accent-100 text-accent-800 rounded",children:['搜索: "',a.search.trim(),'"',e.jsx("button",{onClick:()=>x({search:""}),className:"ml-1 hover:text-accent-600",children:e.jsx(X,{className:"w-3 h-3"})})]}),a.tags.map(i=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-accent-100 text-accent-800 rounded",children:["#",i,e.jsx("button",{onClick:()=>N(i),className:"ml-1 hover:text-accent-600",children:e.jsx(X,{className:"w-3 h-3"})})]},i)),a.states.map(i=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-accent-100 text-accent-800 rounded",children:[Ne.find(f=>f.value===i)?.label||i,e.jsx("button",{onClick:()=>y(i),className:"ml-1 hover:text-accent-600",children:e.jsx(X,{className:"w-3 h-3"})})]},i)),(a.dueDateRange.start||a.dueDateRange.end)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-accent-100 text-accent-800 rounded",children:["日期: ",a.dueDateRange.start||"..."," - ",a.dueDateRange.end||"...",e.jsx("button",{onClick:()=>x({dueDateRange:{start:"",end:""}}),className:"ml-1 hover:text-accent-600",children:e.jsx(X,{className:"w-3 h-3"})})]})]})})]})},Vt=({deckId:t,onBack:s,onStartLearning:n,onCreateNote:a,onEditNote:h})=>{const[r,p]=c.useState(null),[l,o]=c.useState([]),[m,x]=c.useState([]),[C,N]=c.useState(!0),[y,D]=c.useState(null),[i,f]=c.useState(!1),[v,k]=c.useState("table"),[u,w]=c.useState(new Set),[F,E]=c.useState(null),[S,b]=c.useState(0),A=new ie;c.useEffect(()=>{d()},[t]);const d=async()=>{try{N(!0),console.log("Loading deck:",t);const j=await A.getDeckById(t);console.log("Deck data received:",j),p(j),console.log("Loading cards for deck:",t);const T=await A.getCardsByDeckId(t);if(console.log("Cards data received:",T.length,"cards"),T.length>0){const z=T[0];console.log("Sample card structure:",{id:z.id,due:z.due,dueType:typeof z.due,state:z.state})}const q=await Promise.all(T.map(async z=>{try{const Q=await A.getNoteById(z.noteId);return{...z,note:Q}}catch(Q){return console.error(`Failed to load note for card ${z.id}:`,Q),P.error(`加载卡片 ${z.id} 的内容失败`),z}}));console.log("Cards with notes loaded successfully:",q.length);const Te=new Date,Fe=q.filter(z=>z.state==="New"?!0:z.due?new Date(z.due)<=Te:!1);b(Fe.length),o(q),x(q)}catch(j){console.error("Failed to load deck and cards:",j),j instanceof Error?j.message.includes("not found")?P.error("牌组不存在或已被删除"):j.message.includes("Database not initialized")?P.error("数据库连接失败，请重新加载页面"):P.error(`加载失败: ${j.message}`):P.error("加载牌组内容失败，请重试")}finally{N(!1)}},g=()=>{n(t)},R=()=>{a(t)},$=j=>{D(j),f(!0)},O=j=>{const T=j;h&&T.note?h(T.note.id):P.error("无法编辑此卡片：缺少笔记信息")},H=j=>{P.success("删除功能即将推出")},$e=(j,T)=>{const q=new Set(u);T?q.add(j):q.delete(j),w(q)},Re=j=>{w(j?new Set(m.map(T=>T.id)):new Set)},Me=j=>{x(j),w(new Set)},ye=j=>{switch(j){case"New":return"bg-blue-100 text-blue-800";case"Learning":return"bg-yellow-100 text-yellow-800";case"Review":return"bg-green-100 text-green-800";case"Relearning":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},fe=j=>{if(!j.note)return"内容加载中...";const T=j.note.fields;switch(j.cardType){case"CtoE":return T.CtoE?.chinese||"无内容";case"Retranslate":return T.Retranslate?.originalText||"无内容";default:return"未知卡片类型"}};return C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3 text-primary-600",children:[e.jsx(ae,{className:"w-6 h-6 animate-pulse"}),e.jsx("span",{className:"text-lg font-medium",children:"加载卡片中..."})]})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:s,className:"p-2 text-primary-500 hover:text-primary-700 hover:bg-primary-100 rounded-lg transition-colors",title:"返回牌组列表",children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:r.name}),r.description&&e.jsx("p",{className:"text-primary-600 mt-1",children:r.description}),e.jsxs("p",{className:"text-sm text-primary-500 mt-1",children:["共 ",l.length," 张卡片",F&&m.length!==l.length&&e.jsxs("span",{className:"ml-2 text-accent-600",children:["(已过滤显示 ",m.length," 张)"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center bg-primary-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>k("table"),className:`p-2 rounded-md transition-colors ${v==="table"?"bg-white text-primary-900 shadow-sm":"text-primary-600 hover:text-primary-900"}`,title:"表格视图",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>k("grid"),className:`p-2 rounded-md transition-colors ${v==="grid"?"bg-white text-primary-900 shadow-sm":"text-primary-600 hover:text-primary-900"}`,title:"网格视图",children:e.jsx(Ve,{className:"w-4 h-4"})})]}),u.size>0&&e.jsxs("span",{className:"px-3 py-1 bg-accent-100 text-accent-800 rounded-full text-sm",children:["已选择 ",u.size," 张卡片"]}),e.jsxs("button",{onClick:R,className:"btn-accent flex items-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"新建卡片"})]}),e.jsxs("button",{onClick:g,disabled:S===0,className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-colors ${S>0?"bg-accent-500 hover:bg-accent-600 text-white":"bg-primary-200 text-primary-500 cursor-not-allowed"}`,title:S>0?"开始复习卡片":"暂无到期卡片",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:S>0?`复习卡片 (${S})`:"暂无复习"})]})]})]}),l.length>0&&e.jsx(qt,{cards:l,onFilterChange:Me,onFilterStateChange:E}),l.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(_,{className:"w-20 h-20 mx-auto text-primary-400 mb-6"}),e.jsx("h3",{className:"text-xl font-semibold text-primary-900 mb-3",children:"暂无卡片"}),e.jsx("p",{className:"text-primary-600 mb-8 max-w-md mx-auto",children:"这个牌组还没有卡片。创建第一张卡片开始学习吧！"}),e.jsx("button",{onClick:R,className:"btn-primary",children:"创建第一张卡片"})]}):v==="table"?e.jsx(It,{cards:m,onCardClick:$,onEditCard:O,onDeleteCard:H,selectedCards:u,onSelectCard:$e,onSelectAll:Re}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(j=>e.jsxs("div",{className:"card-industrial-hover p-4 cursor-pointer group",onClick:()=>$(j),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ye(j.state)}`,children:j.state==="New"?"新卡片":j.state==="Learning"?"学习中":j.state==="Review"?"复习中":"重新学习"}),e.jsxs("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:T=>{T.stopPropagation(),O(j)},className:"p-1 text-primary-500 hover:text-accent-600 hover:bg-primary-100 rounded transition-colors",title:"编辑卡片",children:e.jsx(le,{className:"w-3 h-3"})}),e.jsx("button",{onClick:T=>{T.stopPropagation(),H()},className:"p-1 text-primary-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"删除卡片",children:e.jsx(Y,{className:"w-3 h-3"})})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("p",{className:"text-sm text-primary-900 line-clamp-3",children:fe(j)})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-primary-500",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{children:["复习 ",j.reps," 次"]}),e.jsxs("span",{children:["遗忘 ",j.lapses," 次"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{children:Ee(j.due)})]})]})]},j.id))}),i&&y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-900",children:"卡片详情"}),e.jsx("button",{onClick:()=>f(!1),className:"p-2 text-primary-500 hover:text-primary-700 hover:bg-primary-100 rounded-lg transition-colors",children:"×"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1",children:"状态"}),e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${ye(y.state)}`,children:y.state==="New"?"新卡片":y.state==="Learning"?"学习中":y.state==="Review"?"复习中":"重新学习"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1",children:"内容"}),e.jsx("div",{className:"bg-primary-50 rounded-lg p-3",children:e.jsx("p",{className:"text-primary-900",children:fe(y)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1",children:"复习次数"}),e.jsx("p",{className:"text-primary-900",children:y.reps})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1",children:"遗忘次数"}),e.jsx("p",{className:"text-primary-900",children:y.lapses})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1",children:"稳定性"}),e.jsx("p",{className:"text-primary-900",children:y.stability.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1",children:"难度"}),e.jsx("p",{className:"text-primary-900",children:y.difficulty.toFixed(2)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1",children:"下次复习"}),e.jsx("p",{className:"text-primary-900",children:xe(y.due)})]})]})]})})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"w-16 h-16 mx-auto text-primary-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-primary-900 mb-2",children:"牌组不存在"}),e.jsx("p",{className:"text-primary-600 mb-4",children:"请检查牌组ID是否正确"}),e.jsx("button",{onClick:s,className:"btn-primary",children:"返回首页"})]})},_t=()=>{const[t,s]=c.useState("home"),[n,a]=c.useState(null),[h,r]=c.useState(null),p=y=>{a(y),r(null),s("cardBrowser")},l=y=>{a(y),r(null),s("review")},o=y=>{a(y),r(null),s("notes")},m=y=>{r(y),s("notes")},x=y=>{s(y),(y==="home"||y==="review")&&(a(null),r(null))},C=()=>{r(null),s("cardBrowser")},N=()=>{switch(t){case"home":return e.jsx(je,{onDeckSelect:p,onCreateNote:o,onStartReview:l});case"cardBrowser":return n?e.jsx(Vt,{deckId:n,onBack:()=>x("home"),onStartLearning:l,onCreateNote:o,onEditNote:m}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"w-16 h-16 mx-auto text-primary-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-primary-900 mb-2",children:"请先选择牌组"}),e.jsx("p",{className:"text-primary-600",children:"从首页选择一个牌组查看卡片"}),e.jsx("button",{onClick:()=>x("home"),className:"btn-primary mt-4",children:"返回首页"})]});case"notes":return n?e.jsx(Ht,{deckId:n,noteId:h||void 0,onBack:h?C:()=>x("home"),onNoteSaved:()=>{h&&C(),console.log("Note saved successfully")}}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"w-16 h-16 mx-auto text-primary-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-primary-900 mb-2",children:"请先选择牌组"}),e.jsx("p",{className:"text-primary-600",children:"从首页选择一个牌组开始创建笔记"}),e.jsx("button",{onClick:()=>x("home"),className:"btn-primary mt-4",children:"返回首页"})]});case"review":return e.jsx(Ot,{deckId:n,onBack:()=>x("home")});case"stats":return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ae,{className:"w-16 h-16 mx-auto text-primary-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-primary-900 mb-2",children:"学习统计"}),e.jsx("p",{className:"text-primary-600",children:"即将推出..."})]});case"settings":return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"w-16 h-16 mx-auto text-primary-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-primary-900 mb-2",children:"设置"}),e.jsx("p",{className:"text-primary-600",children:"即将推出..."})]});default:return e.jsx(je,{onDeckSelect:p})}};return e.jsxs("div",{className:"min-h-screen bg-primary-50",children:[e.jsx(Pt,{position:"top-right",toastOptions:{duration:3e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10B981",secondary:"#fff"}},error:{duration:4e3,iconTheme:{primary:"#EF4444",secondary:"#fff"}}}}),e.jsx("header",{className:"bg-primary-700 text-white shadow-industrial",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Ae,{className:"w-8 h-8"}),e.jsx("h1",{className:"text-xl font-bold",children:"LanGear Language Learning"})]}),e.jsxs("nav",{className:"flex items-center space-x-6",children:[e.jsxs("button",{onClick:()=>x("home"),className:`flex items-center space-x-2 px-3 py-2 rounded-industrial transition-colors ${t==="home"?"bg-primary-600 hover:bg-primary-500":"hover:bg-primary-600"}`,children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{children:"首页"})]}),e.jsxs("button",{onClick:()=>x("review"),className:`flex items-center space-x-2 px-3 py-2 rounded-industrial transition-colors ${t==="review"?"bg-primary-600 hover:bg-primary-500":"hover:bg-primary-600"}`,children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{children:"复习"})]}),e.jsxs("button",{onClick:()=>x("stats"),className:`flex items-center space-x-2 px-3 py-2 rounded-industrial transition-colors ${t==="stats"?"bg-primary-600 hover:bg-primary-500":"hover:bg-primary-600"}`,children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"统计"})]}),e.jsxs("button",{onClick:()=>x("settings"),className:`flex items-center space-x-2 px-3 py-2 rounded-industrial transition-colors ${t==="settings"?"bg-primary-600 hover:bg-primary-500":"hover:bg-primary-600"}`,children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{children:"设置"})]})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:N()})]})},ve=document.getElementById("main-root");ve&&ze(ve).render(e.jsx(_t,{}));
